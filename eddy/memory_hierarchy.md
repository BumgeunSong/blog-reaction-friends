# 메모리 계층 뽀개기

거대한 도서관을 생각해보자. 이 도서관은 수백년 된 고서부터 신간까지, 수십만권의 책을 보관하고 있다. 도서관은 책을 어떤 방식으로 보관하고 있을까?

책꽂이에다 꽂아놓겠지. 쉽게 생각하면 그렇지만 자세히 들여다보면 그렇지 않다.

사람들이 자주 찾는 책이나 신간은 훨씬 더 잘보이는 곳에 배치되어있고, 쉽게 찾을 수 있도록 책 등이 아닌 책 표지를 꺼내놓는다.

사람들이 잘 찾지 않는 책이나 오래된 책들은 일반 서가가 아닌, 별도의 서고에 집어넣는다. 이런 서고는 공간 효율적으로 많은 책을 저장할 수 있는 특수한 서가로 이뤄져있다. 정말 큰 도서관은 보통 사람들이 들어갈 수 없는 서고가 수십개씩 있는 경우도 있다.

책을 보관할 수 있는 물리적인 공간은 한정돼있고, 수많은 책 중, 원하는 책을 쉽게 찾을 수 있어야하기 때문이다.

컴퓨터에 저장된 데이터도 마찬가지다. 컴퓨터의 저장 공간도 여러 층으로 나뉘어 있다. 

CPU 안의 레지스터는 가장 많이 사용하는 데이터를 저장하며, 매우 빠르게 데이터를 가져올 수 있다. CPU 옆에 있는, 작지만 빠른 캐시 메모리가 있다. 비교적 더 느린 메인 메모리와 CPU 사이의 중간 다리 역할을 한다. 

메인 메모리는 또 자기보다 더 느린 디스크나 외부 저장소의 중간 다리 역할을 한다.

모든 컴퓨팅 시스템에 이런 식으로 계층이 형성되는 이유는 2가지 특성 때문이다.

1. 저장 매체의 가격, 성능 트레이드 오프
2. 대부분의 프로그램이 가지는 지역성

이 2가지에 대해서는 뒤에 좀 더 자세히 설명하자.


## 프로그래머가 이걸 알아야하는 이유

단순하다. 메모리 계층 구조는 애플리케이션 성능에 아주 큰 영향을 미친다. 우리가 사용하려는 데이터가 어떤 층에 저장돼있냐에 따라서 프로그램의 성능은 수십배 - 수천만배까지 차이가 난다.

메모리 접근 속도는 CPU의 계산 속도가 증가하는만큼 빠르게 증가하고 있지 않다. 따라서 메모리에서 데이터를 가져오는 시간은 전체 프로그램의 성능을 크게 좌우하는 요소다.

즉, 프로그램의 성능을 이해하려면 메모리 계층을 잘 알아야 한다.

이번 글에서는 메모리 계층과 캐싱의 원리를 알아보자. 이 글을 다 읽고 나면 메모리 접근 속도의 근본 원리를 이해하는 개발자가 될 수 있을 것이다!


## 1. 저장 매체

메모리 계층이 생기는 첫번째 이유. 저장 매체 기술에 대해 알아보자.

당연한 말이지만, 컴퓨터에는 데이터를 저장하고 유지할 공간이 필요하다. 컴퓨터는 0과 1이라는 비트 정보를 저장하기 위해서 다양한 도구를 쓴다. 

그 중 가장 중요한 3개가 RAM, ROM, 디스크다.

![Storage_tech]

## 1. RAM
RAM에는 크게 2가지가 있다.

Random Access Memory이다. Random Access는 순차적 접근의 반대말이다. 몇번째에 있는지 알면 즉시 거기로 가서 값을 읽어올 수 있다. 데이터 접근이 빠르다. 

RAM은 휘발성 메모리다. 전기 공급이 끊어지면 다 날아간다. 


### Static RAM (SRAM)
가장 빠르고 비싼 메모리.

메모리계의 포르쉐라고 할 수 있다.

SRAM은 6개의 트랜지스터로 만든 플립플롭이라는 회로에 하나의 비트를 저장한다. 트랜지스터가 6개 사용되기 때문에 밀도를 높이기가 어렵고 가격이 비싸다.

SRAM은 전기가 들어오는 동안에는 기록된 비트 값이 안정적으로 유지된다. 전기적 노이즈 같은 게 있어도 끄떡없다.

반대로 끄떡있는 녀석은...

### Dynamic RAM (DRAM)

DRAM이다. 

DRAM은 SRAM보다 싸고 많은 양을 담을 수 있다. 

DRAM에 많은 양의 데이터가 들어가는 이유는, '캐파시터'라고 하는 아주 작은 상자에 전자를 담기 때문이다. 캐파시터 전자가 있으면 1, 아니면 0으로 비트를 표현한다. 

트랜지스터를 1개 사용해서 캐파시터 뚜껑을 덮어서 상태를 유지한다.

캐파시터는 작고 트랜지스터를 하나만 사용하기 때문에, 밀도를 매우 높일 수 있고, 가격도 SRAM보다 저렴하다.

하지만 문제는 이 캐파시터의 전하가 시간이 지나면 새어나간다. 방전된다. 시간이 지나면 값이 사라진다. 

마치 모래 위에 쓴 글씨처럼 말이다. 

안정적인 SRAM과 달리 계속 변화한다고 해서 Dynamic RAM이라는 이름이 붙었다.

DRAM은 방전되어 내용이 사라지기 전에 충전을 다시 해줘야 한다.
DRAM의 전하가 유지되는 시간은 10MS에서 100MS 정도다. 0.01초에서 0.1초만 지나면 내용이 사라진다.

> 아니 그런 걸 쓸수가 있나?

하지만 우리의 시간과 컴퓨터의 시간은 다르기 때문에 괜찮다.컴퓨터의 클락 사이클은 나노세컨드 (십억분의 1초)이다.


### SRAM과 DRAM의 차이
빠르고 안정적이지만, 비싸서 조금밖에 못쓰는 게 SRAM.
덜 빠르고 불안정하지만, 싸서 많이 쓸 수 있는 게 DRAM.

## 2. ROM

ROM은 비휘발성 메모리다. RAM만큼 데이터를 빠르게 가져올 수 있진 않지만, 전원이 꺼져도 정보를 저장해주는 믿을 수 있는 친구다. 

즉, 전기가 들어오지 않아도 계속해서 정보를 유지해야 한다. 
전기가 공급되지 않아도, 정보를 저장하는 방법은 시대를 걸쳐서 여러가지 방법이 진화해왔다.

최초의 ROM은 천공 카드라고 한다. OMR 카드 같이 생겼는데 여기에 구멍을 뚫어서 비트를 표시했다. 

그 다음에는 점점 더 효율적인 ROM들이 등장했다. 프로그래밍이 가능한 ROM (PROM), 쓴 데이터를 지울 수 있는 PROM (ERPOM), 전기적으로 작동하는 EPROM (EEPROM) 등.

### 플래시 메모리
EEPROM 중에서도 가장 많이 쓰이는 기술이 1980년대 일본도시바 사에서 개발한 플래시 메모리다.
플래시 메모리는 비휘발성인데도 내구성이 매우 강하고, 읽기 속도가 빠르고, 전력도 적게 쓴다. 
우리가 사용하는 USB 드라이브, 디지털 카메라, 스마트폰 다 이 플래시 메모리를 사용한다.



## 2. 지역성

## 3. 메모리 계층

## 4. 캐싱