# 프로세스와 스레드

프로그래밍을 하기 위해서 꼭 알아야하는 지식. 프로세스와 스레드에 대해 얘기해보도록 하자.

## 개념

프로세스는 컴퓨터 공학에서 가장 성공한, 그리고 심오한 개념이다. 우리는 프로그램에게 일종의 환상을 제공한다. 마치 프로그램이 자기 혼자서 이 시스템에서 돌아가는 것처럼. 프로그램 입장에서는 프로세서와 메모리를 혼자 사용하는 것처럼 보인다. 프로세스라는 개념이 바로 이런 환상을 만들어준다.

프로세스의 정의는 실행중인 프로그램이다. 프로그램은 그냥 디스크에 저장된, 잠들어있는 바이너리로된 명령어 파일이다. 프로그램이 사용자에게 기능을 제공하기 위해서 메모리 공간을 할당받은 상태가 프로세스다. 메모리를 할당받았기 때문에 프로그램은 이제 '상태'를 가질 수 있으며, 실행할 준비가 된다.

시스템의 각 프로그램은, 프로세스의 컨텍스트 안에서 실행된다. 컨텍스트란 프로그램이 제대로 돌아가기 위해 필요한 '상태'다. 프로세스는 정적인 프로그램에 '상태(State)'가 추가된 거라고 볼 수 있다.

프로세스라는 개념이 존재하는 이유는, 운영체제가 한정된 하드웨어 자원을 여러 프로그램에게 나누어줘야 하기 때문이다. 프로세스는 운영체제가 프로그램에게 메모리를 할당하는 기본 단위다.

프로세스 안에는 스레드가 있다. 스레드는 프로세스가 가진 메모리 자원을 공유한다. 하지만 실행흐름은 독립적으로 가진다. 스레드라는 단위는 독립적인 실행흐름을 가지기 때문에, 프로세서를 할당했을 때 독립적으로 실행이 된다. 함수를 호출하고, 변수를 저장하고, 공유 데이터를 변경하는 등 프로세스 안에 주어진 자원을 '제어'한다.

스레드는 운영체제가 '프로세서'를 할당하는 기본 단위다.

## 문제집 비유

좀 더 이해하기 쉽게 비유를 해보자. 

책꽂이에 문제집이 꽃혀 있다. 이건 아무런 상태도 없는 정적인 데이터, 즉 프로그램이다.

이 문제집을 꺼내 책상에 놓고, 옆에 연습장과 답안지를 준비한다. 그러면 이 프로그램은 이제 읽고 풀 준비가 완료된다. 문제집을 푼 다음, 답을 답안지에 적는 것을 실행이라고 보자.이 문제집은 실행 중인 프로그램, 즉 프로세스가 되는 것이다.

꺼내진 문제집, 책상 상태에서 이제 책상에 한 학생이 앉아 그 문제집에 나온 문제들을 풀기 시작한다. 이 학생은 바로 프로세서다. 

그런데 학생 혼자서는 문제집을 빨리 풀기 어려울 것 같다. 동시에 여러 학생이 이 문제집을 풀게 하고 싶다.

문제집을 챕터별로 나눠서, 분권을 한다. 문제집 안에 들어있는 문제를 여러 책으로 쪼갠다. 그리고 나눠진 문제집을 펼치고 옆에 풀이를 할 수 있는 연습장을 갖다둔다. 

이 각 분권이 바로 '스레드'다. 프로세스 안의 문제들 (명령어) 들이 별도의 책으로 쪼개진 것이다. 이제 쪼개진 책은 동시에 펼칠 수 있고, 각각에 해당하는 연습장이 주어진다. 따라서 새로운 학생이 와서, 이 문제집을 풀 수 있다.

다만 이때 문제를 푼 내용을 적는 답안지는 서로 공유를 한다. 각자 나눠서 풀되 답안지는 함께 작성하는 것이다. 이 답안지가 바로 스레드가 공유하는 자원, 즉 힙이라고 보면 된다. 

반면 각 분권마다 주어지고, 문제를 풀 때 필요한 풀이과정을 기록하는 연습장은, 스택이다. 즉, 각 스레드는 스택을 가진다. 하지만 하나의 문제집끼리는 답안지를 공유하듯이, 같은 프로세스의 스레드끼리는 힙 영역을 공유한다.

분권과 각각의 연습장이 존재하기 때문에 하나의 문제집을 푸는 여러가지 실행 흐름이 가능해지게 된다. 한 분권에서는 문제 4번을 풀고 있고, 한 분권에서는 문제 12번을 풀고 있을 수 있다.
